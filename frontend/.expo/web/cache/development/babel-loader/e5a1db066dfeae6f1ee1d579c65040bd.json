{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"D:\\\\projects\\\\cargo_app\\\\frontend\\\\src\\\\components\\\\forms\\\\waybill-form\\\\waybill-form.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState } from \"react\";\nimport { Form, Formik } from \"formik\";\nimport { Button } from \"@material-ui/core\";\nimport { saveWaybill } from \"../../roles/manager/request-utils\";\nimport { WaybillFormValidation } from \"../../parts/validation/waybill-form-validation\";\nimport FormControl from \"@material-ui/core/FormControl\";\nimport DatePickerField from \"../../parts/layout/date-picker\";\nimport ManagerMapForPointAdding from \"../../../map/manager-map-for-points-creating\";\nimport { convertPointsToBackendApi, countDistanceBetweenMarkers } from \"../../../map/utils\";\nimport TextField from \"@material-ui/core/TextField\";\nimport { connect } from \"react-redux\";\nimport Paper from \"@material-ui/core/Paper\";\nimport makeStyles from \"@material-ui/core/styles/makeStyles\";\nimport useToast from \"../../parts/toast-notification/useToast\";\nimport AutoSearch from \"./auto-search\";\nimport { countTotalWeight } from \"../../parts/util/cargo-total-info\";\nimport Grid from \"@material-ui/core/Grid\";\nimport { AUTO_URL, handleRequestError, makeRequest } from \"../../parts/util/request-util\";\nvar EMPTY_AUTO = {\n  id: -1,\n  mark: \"\",\n  autoType: \"\"\n};\n\nvar mapStateToProps = function mapStateToProps(store) {\n  return {\n    role: store.user.roles[0]\n  };\n};\n\nexport var WaybillForm = connect(mapStateToProps)(function (props) {\n  var _useToast = useToast(),\n      _useToast2 = _slicedToArray(_useToast, 2),\n      ToastComponent = _useToast2[0],\n      openToast = _useToast2[1];\n\n  var _useState = useState(props.invoice),\n      _useState2 = _slicedToArray(_useState, 2),\n      invoice = _useState2[0],\n      setInvoice = _useState2[1];\n\n  var _useState3 = useState(EMPTY_AUTO),\n      _useState4 = _slicedToArray(_useState3, 2),\n      selectedAuto = _useState4[0],\n      setSelectedAuto = _useState4[1];\n\n  var _useState5 = useState(0),\n      _useState6 = _slicedToArray(_useState5, 2),\n      pointIndex = _useState6[0],\n      setPointIndex = _useState6[1];\n\n  var _useState7 = useState([]),\n      _useState8 = _slicedToArray(_useState7, 2),\n      points = _useState8[0],\n      setPoints = _useState8[1];\n\n  var _useState9 = useState([]),\n      _useState10 = _slicedToArray(_useState9, 2),\n      autos = _useState10[0],\n      setAutos = _useState10[1];\n\n  var _useState11 = useState(0),\n      _useState12 = _slicedToArray(_useState11, 2),\n      distance = _useState12[0],\n      setDistance = _useState12[1];\n\n  var useStyles = makeStyles(function () {\n    return {\n      formControl: {\n        marginTop: 20,\n        minWidth: \"100%\"\n      },\n      infoPart: {\n        flexDirection: \"column\",\n        alignItems: \"flex-start\",\n        minWidth: \"35%\",\n        padding: 10\n      }\n    };\n  });\n  var classes = useStyles();\n  var invoiceProductsWeight = countTotalWeight(props.invoice.products);\n  useEffect(function () {\n    setInvoice(props.invoice);\n  }, [props.invoice]);\n\n  var updateDistance = function updateDistance(points) {\n    setDistance(countDistanceBetweenMarkers(points) / 1000);\n  };\n\n  function fetchAutos(cleanupFunction) {\n    var url, res;\n    return _regeneratorRuntime.async(function fetchAutos$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (cleanupFunction) {\n              _context.next = 12;\n              break;\n            }\n\n            _context.prev = 1;\n            url = AUTO_URL + \"?statuses=ACTIVE\";\n            _context.next = 5;\n            return _regeneratorRuntime.awrap(makeRequest(\"GET\", url));\n\n          case 5:\n            res = _context.sent;\n            setAutos(res.data.autoList);\n            _context.next = 12;\n            break;\n\n          case 9:\n            _context.prev = 9;\n            _context.t0 = _context[\"catch\"](1);\n            handleRequestError(_context.t0, openToast);\n\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[1, 9]], Promise);\n  }\n\n  useEffect(function () {\n    var cleanupFunction = false;\n    fetchAutos(cleanupFunction);\n    return function () {\n      return cleanupFunction = true;\n    };\n  }, []);\n\n  var handlePointDelete = function handlePointDelete(marker) {\n    for (var i = 0; i < points.length; i++) {\n      if (marker.index === points[i].index) {\n        var newPoints = points;\n        newPoints.splice(i, 1);\n        setPoints(newPoints);\n        updateDistance(newPoints);\n      }\n    }\n  };\n\n  var handlePointAdd = function handlePointAdd(event) {\n    var newPoints = [].concat(_toConsumableArray(points), [{\n      isPassed: false,\n      passageDate: null,\n      index: pointIndex,\n      lat: event.latLng.lat(),\n      lng: event.latLng.lng()\n    }]);\n    setPoints(newPoints);\n    setPointIndex(pointIndex + 1);\n    updateDistance(newPoints);\n  };\n\n  var handleSubmit = function handleSubmit(values) {\n    if (points.length > 1) {\n      if (selectedAuto.id === -1) {\n        openToast(\"Select auto\", \"warning\");\n        return;\n      }\n\n      if (selectedAuto.maxLoad < invoiceProductsWeight) {\n        openToast(\"Weight is overloaded for \" + (invoiceProductsWeight - selectedAuto.maxLoad) + \" kg.\\nSelect another car.\", \"warning\");\n        return;\n      }\n\n      var waybill = {};\n      waybill.points = convertPointsToBackendApi(points);\n      waybill.invoiceId = values.invoiceId;\n      waybill.autoId = selectedAuto.id;\n      waybill.departureDate = values.departureDate;\n      waybill.arrivalDate = values.arrivalDate;\n      waybill.distance = distance;\n\n      var saveWaybillRequest = function saveWaybillRequest(waybill) {\n        return _regeneratorRuntime.async(function saveWaybillRequest$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return _regeneratorRuntime.awrap(saveWaybill(waybill));\n\n              case 2:\n                props.onSave();\n                props.onClose();\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, null, null, null, Promise);\n      };\n\n      saveWaybillRequest(waybill);\n    } else {\n      openToast(\"It's necessary to put at least 2 point\", \"warning\");\n    }\n  };\n\n  var handleAutoSelect = function handleAutoSelect(auto) {\n    if (auto === null) setSelectedAuto(EMPTY_AUTO);else {\n      setSelectedAuto(auto);\n    }\n  };\n\n  var convertShipperAndConsigneeToStringInInvoices = function convertShipperAndConsigneeToStringInInvoices(invoice) {\n    if (invoice.shipper.id === null || invoice.shipper.id === undefined) {\n      return invoice;\n    }\n\n    invoice = convertShipperAndConsigneeToString(invoice);\n    return invoice;\n  };\n\n  var convertShipperAndConsigneeToString = function convertShipperAndConsigneeToString(invoice) {\n    var shipperAddress = invoice.shipper.address;\n    var consigneeAddress = invoice.consignee.address;\n    return _objectSpread(_objectSpread({}, invoice), {}, {\n      shipper: shipperAddress.country + \" \" + shipperAddress.city + \" \" + shipperAddress.street + \"  \" + shipperAddress.house,\n      consignee: consigneeAddress.country + \" \" + consigneeAddress.city + \" \" + consigneeAddress.street + \" \" + consigneeAddress.house\n    });\n  };\n\n  var date = new Date();\n  var today = date.toISOString().substring(0, date.toISOString().indexOf(\"T\"));\n  return React.createElement(React.Fragment, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 9\n    }\n  }, React.createElement(Formik, {\n    enableReinitialize: true,\n    initialValues: {\n      departureDate: today,\n      arrivalDate: today,\n      autoId: selectedAuto.id,\n      invoiceId: invoice.id,\n      points: points.length\n    },\n    onSubmit: handleSubmit,\n    validationSchema: WaybillFormValidation,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 13\n    }\n  }, function (formProps) {\n    return React.createElement(Form, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 21\n      }\n    }, React.createElement(\"div\", {\n      className: \"info-content\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 25\n      }\n    }, React.createElement(\"div\", {\n      className: \"info-content-column\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 29\n      }\n    }, React.createElement(Paper, {\n      className: \"table-paper\",\n      style: {\n        flexDirection: \"column\",\n        alignItems: \"flex-start\",\n        minWidth: \"35%\",\n        padding: 10\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 33\n      }\n    }, React.createElement(FormControl, {\n      className: classes.formControl,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 37\n      }\n    }, React.createElement(AutoSearch, {\n      autoArr: autos,\n      onAutoSelect: handleAutoSelect,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 41\n      }\n    })), React.createElement(DatePickerField, {\n      formikProps: formProps,\n      id: \"departureDate\",\n      formikFieldName: \"departureDate\",\n      label: \"Departure date\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 37\n      }\n    }), React.createElement(DatePickerField, {\n      formikProps: formProps,\n      id: \"arrivalDate\",\n      formikFieldName: \"arrivalDate\",\n      label: \"Arrival date\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 37\n      }\n    }), React.createElement(TextField, {\n      name: \"shipper\",\n      label: \"Shipper\",\n      type: \"text\",\n      id: \"shipper\",\n      disabled: true,\n      value: invoice.shipper.address === undefined ? invoice.shipper : invoice.shipper.address.country + \" \" + invoice.shipper.address.city + \" \" + invoice.shipper.address.street + \"  \" + invoice.shipper.address.house,\n      style: {\n        width: \"100%\"\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 37\n      }\n    }), React.createElement(\"br\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 37\n      }\n    }), React.createElement(\"br\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 42\n      }\n    }), React.createElement(TextField, {\n      name: \"consignee\",\n      label: \"Consignee\",\n      type: \"text\",\n      id: \"consignee\",\n      disabled: true,\n      value: invoice.consignee.address === undefined ? invoice.consignee : invoice.consignee.address.country + \" \" + invoice.consignee.address.city + \" \" + invoice.consignee.address.street + \"  \" + invoice.consignee.address.house,\n      style: {\n        width: \"100%\"\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 37\n      }\n    }), React.createElement(\"br\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 37\n      }\n    }), React.createElement(\"br\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 42\n      }\n    }), React.createElement(\"br\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 37\n      }\n    }), React.createElement(\"br\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 42\n      }\n    }), React.createElement(Grid, {\n      container: true,\n      justify: \"center\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 37\n      }\n    }, React.createElement(Grid, {\n      item: true,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 41\n      }\n    }, React.createElement(Button, {\n      variant: \"contained\",\n      color: \"primary\",\n      type: \"submit\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 45\n      }\n    }, \"Save waybill\")))), React.createElement(Paper, {\n      className: \"table-paper\",\n      style: {\n        flexDirection: \"column\",\n        alignItems: \"flex-start\",\n        padding: 10,\n        maxWidth: \"60%\"\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 33\n      }\n    }, React.createElement(ManagerMapForPointAdding, {\n      markers: points,\n      onMarkerAdd: handlePointAdd,\n      onMarkerDelete: handlePointDelete,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250,\n        columnNumber: 37\n      }\n    })))));\n  }), ToastComponent);\n});","map":{"version":3,"sources":["D:/projects/cargo_app/frontend/src/components/forms/waybill-form/waybill-form.js"],"names":["React","useEffect","useState","Form","Formik","Button","saveWaybill","WaybillFormValidation","FormControl","DatePickerField","ManagerMapForPointAdding","convertPointsToBackendApi","countDistanceBetweenMarkers","TextField","connect","Paper","makeStyles","useToast","AutoSearch","countTotalWeight","Grid","AUTO_URL","handleRequestError","makeRequest","EMPTY_AUTO","id","mark","autoType","mapStateToProps","store","role","user","roles","WaybillForm","props","ToastComponent","openToast","invoice","setInvoice","selectedAuto","setSelectedAuto","pointIndex","setPointIndex","points","setPoints","autos","setAutos","distance","setDistance","useStyles","formControl","marginTop","minWidth","infoPart","flexDirection","alignItems","padding","classes","invoiceProductsWeight","products","updateDistance","fetchAutos","cleanupFunction","url","res","data","autoList","handlePointDelete","marker","i","length","index","newPoints","splice","handlePointAdd","event","isPassed","passageDate","lat","latLng","lng","handleSubmit","values","maxLoad","waybill","invoiceId","autoId","departureDate","arrivalDate","saveWaybillRequest","onSave","onClose","handleAutoSelect","auto","convertShipperAndConsigneeToStringInInvoices","shipper","undefined","convertShipperAndConsigneeToString","shipperAddress","address","consigneeAddress","consignee","country","city","street","house","date","Date","today","toISOString","substring","indexOf","formProps","width","maxWidth"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from \"react\";\r\nimport {Form, Formik} from \"formik\";\r\nimport {Button} from \"@material-ui/core\";\r\nimport {saveWaybill} from \"../../roles/manager/request-utils\";\r\nimport {WaybillFormValidation} from \"../../parts/validation/waybill-form-validation\";\r\nimport FormControl from \"@material-ui/core/FormControl\";\r\nimport DatePickerField from \"../../parts/layout/date-picker\";\r\nimport ManagerMapForPointAdding from \"../../../map/manager-map-for-points-creating\";\r\nimport {convertPointsToBackendApi, countDistanceBetweenMarkers} from \"../../../map/utils\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport {connect} from \"react-redux\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport makeStyles from \"@material-ui/core/styles/makeStyles\";\r\nimport useToast from \"../../parts/toast-notification/useToast\";\r\nimport AutoSearch from \"./auto-search\";\r\nimport {countTotalWeight} from \"../../parts/util/cargo-total-info\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport {AUTO_URL, handleRequestError, makeRequest} from \"../../parts/util/request-util\";\r\n\r\nconst EMPTY_AUTO = {\r\n    id: -1,\r\n    mark: \"\",\r\n    autoType: \"\",\r\n};\r\n\r\nconst mapStateToProps = (store) => {\r\n    return {\r\n        role: store.user.roles[0]\r\n    }\r\n};\r\n\r\n\r\nexport const WaybillForm = connect(mapStateToProps)((props) => {\r\n    const [ToastComponent, openToast] = useToast();\r\n    const [invoice, setInvoice] = useState(props.invoice);\r\n    const [selectedAuto, setSelectedAuto] = useState(EMPTY_AUTO);\r\n    const [pointIndex, setPointIndex] = useState(0);\r\n    const [points, setPoints] = useState([]);\r\n    const [autos, setAutos] = useState([]);\r\n    const [distance, setDistance] = useState(0);\r\n\r\n    const useStyles = makeStyles(() => ({\r\n        formControl: {\r\n            marginTop: 20,\r\n            minWidth: \"100%\",\r\n        },\r\n        infoPart: {\r\n            flexDirection: \"column\",\r\n            alignItems: \"flex-start\",\r\n            minWidth: \"35%\",\r\n            padding: 10\r\n        }\r\n    }));\r\n    const classes = useStyles();\r\n    const invoiceProductsWeight = countTotalWeight(props.invoice.products);\r\n\r\n    useEffect(() => {\r\n        setInvoice(props.invoice);\r\n    }, [props.invoice]);\r\n\r\n    const updateDistance = (points) => {\r\n        setDistance(countDistanceBetweenMarkers(points) / 1000);\r\n    }\r\n\r\n    async function fetchAutos(cleanupFunction) {\r\n        if (!cleanupFunction) {\r\n            try {\r\n                let url = `${AUTO_URL}?statuses=ACTIVE`;\r\n                let res = await makeRequest(\"GET\", url);\r\n                setAutos(res.data.autoList);\r\n            } catch (err) {\r\n                handleRequestError(err, openToast);\r\n            }\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        let cleanupFunction = false;\r\n        fetchAutos(cleanupFunction);\r\n        return () => cleanupFunction = true;\r\n    }, []);\r\n\r\n    const handlePointDelete = (marker) => {\r\n        for (let i = 0; i < points.length; i++) {\r\n            if (marker.index === points[i].index) {\r\n                let newPoints = points\r\n                newPoints.splice(i, 1);\r\n                setPoints(newPoints);\r\n                updateDistance(newPoints);\r\n            }\r\n        }\r\n    }\r\n\r\n    const handlePointAdd = (event) => {\r\n        let newPoints = [...points, {\r\n            isPassed: false,\r\n            passageDate: null,\r\n            index: pointIndex,\r\n            lat: event.latLng.lat(),\r\n            lng: event.latLng.lng(),\r\n        }]\r\n        setPoints(newPoints)\r\n        setPointIndex(pointIndex + 1);\r\n        updateDistance(newPoints);\r\n    };\r\n\r\n\r\n    const handleSubmit = (values) => {\r\n        if (points.length > 1) {\r\n            if (selectedAuto.id === -1) {\r\n                openToast(\"Select auto\", \"warning\")\r\n                return;\r\n            }\r\n\r\n            if (selectedAuto.maxLoad < invoiceProductsWeight) {\r\n                openToast(\"Weight is overloaded for \" + (invoiceProductsWeight - selectedAuto.maxLoad)\r\n                    + \" kg.\\nSelect another car.\", \"warning\");\r\n                return;\r\n            }\r\n\r\n            const waybill = {};\r\n            waybill.points = convertPointsToBackendApi(points);\r\n            waybill.invoiceId = values.invoiceId;\r\n            waybill.autoId = selectedAuto.id;\r\n            waybill.departureDate = values.departureDate;\r\n            waybill.arrivalDate = values.arrivalDate;\r\n            waybill.distance = distance;\r\n            const saveWaybillRequest = async (waybill) => {\r\n                await saveWaybill(waybill);\r\n                props.onSave();\r\n                props.onClose();\r\n            };\r\n            saveWaybillRequest(waybill);\r\n        } else {\r\n            openToast(\"It's necessary to put at least 2 point\", \"warning\")\r\n        }\r\n    };\r\n\r\n    const handleAutoSelect = (auto) => {\r\n        if (auto === null)\r\n            setSelectedAuto(EMPTY_AUTO)\r\n        else {\r\n            setSelectedAuto(auto);\r\n        }\r\n    };\r\n\r\n    const convertShipperAndConsigneeToStringInInvoices = (invoice) => {\r\n        if (invoice.shipper.id === null || invoice.shipper.id === undefined) {\r\n            return invoice;\r\n        }\r\n        invoice = convertShipperAndConsigneeToString(invoice);\r\n        return invoice;\r\n    }\r\n\r\n    const convertShipperAndConsigneeToString = (invoice) => {\r\n        let shipperAddress = invoice.shipper.address;\r\n        let consigneeAddress = invoice.consignee.address;\r\n        return {\r\n            ...invoice,\r\n            shipper: `${shipperAddress.country} ${shipperAddress.city} ${shipperAddress.street}  ${shipperAddress.house}`,\r\n            consignee: `${consigneeAddress.country} ${consigneeAddress.city} ${consigneeAddress.street} ${consigneeAddress.house}`\r\n        };\r\n    }\r\n\r\n    let date = new Date();\r\n    let today = date.toISOString().substring(0, date.toISOString().indexOf(\"T\"));\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <Formik\r\n                enableReinitialize\r\n                initialValues={{\r\n                    departureDate: today,\r\n                    arrivalDate: today,\r\n                    autoId: selectedAuto.id,\r\n                    invoiceId: invoice.id,\r\n                    points: points.length\r\n                }}\r\n                onSubmit={handleSubmit}\r\n                validationSchema={WaybillFormValidation}\r\n            >\r\n                {(formProps) => (\r\n                    <Form>\r\n                        <div className=\"info-content\">\r\n                            <div className=\"info-content-column\">\r\n                                <Paper className={`table-paper`}\r\n                                       style={{\r\n                                           flexDirection: \"column\",\r\n                                           alignItems: \"flex-start\",\r\n                                           minWidth: \"35%\",\r\n                                           padding: 10\r\n                                       }}>\r\n                                    <FormControl className={classes.formControl}>\r\n                                        <AutoSearch autoArr={autos} onAutoSelect={handleAutoSelect}/>\r\n                                    </FormControl>\r\n\r\n                                    <DatePickerField\r\n                                        formikProps={formProps}\r\n                                        id=\"departureDate\"\r\n                                        formikFieldName=\"departureDate\"\r\n                                        label=\"Departure date\"\r\n                                    />\r\n                                    <DatePickerField\r\n                                        formikProps={formProps}\r\n                                        id=\"arrivalDate\"\r\n                                        formikFieldName=\"arrivalDate\"\r\n                                        label=\"Arrival date\"\r\n                                    />\r\n\r\n                                    <TextField name=\"shipper\"\r\n                                               label=\"Shipper\"\r\n                                               type=\"text\"\r\n                                               id=\"shipper\"\r\n                                               disabled={true}\r\n                                               value={invoice.shipper.address === undefined ?\r\n                                                   invoice.shipper :\r\n                                                   `${invoice.shipper.address.country} ${invoice.shipper.address.city} ${invoice.shipper.address.street}  ${invoice.shipper.address.house}`\r\n                                               }\r\n                                               style={{width: \"100%\"}}/>\r\n\r\n                                    <br/><br/>\r\n                                    <TextField name=\"consignee\"\r\n                                               label=\"Consignee\"\r\n                                               type=\"text\"\r\n                                               id=\"consignee\"\r\n                                               disabled={true}\r\n                                               value={invoice.consignee.address === undefined ?\r\n                                                   invoice.consignee :\r\n                                                   `${invoice.consignee.address.country} ${invoice.consignee.address.city} ${invoice.consignee.address.street}  ${invoice.consignee.address.house}`\r\n                                               }\r\n                                               style={{width: \"100%\"}}/>\r\n\r\n                                    <br/><br/>\r\n                                    <br/><br/>\r\n                                    <Grid container justify={\"center\"}>\r\n                                        <Grid item>\r\n                                            <Button\r\n                                                variant=\"contained\"\r\n                                                color=\"primary\"\r\n                                                type=\"submit\"\r\n\r\n                                            >\r\n                                                Save waybill\r\n                                            </Button>\r\n                                        </Grid>\r\n                                    </Grid>\r\n                                </Paper>\r\n                                <Paper className={`table-paper`}\r\n                                       style={{flexDirection: \"column\", alignItems: \"flex-start\", padding: 10 , maxWidth: \"60%\"}}>\r\n                                    <ManagerMapForPointAdding\r\n                                        markers={points}\r\n                                        onMarkerAdd={handlePointAdd}\r\n                                        onMarkerDelete={handlePointDelete}\r\n                                    />\r\n                                </Paper>\r\n                            </div>\r\n                        </div>\r\n                    </Form>\r\n                )}\r\n            </Formik>\r\n            {ToastComponent}\r\n        </React.Fragment>\r\n    );\r\n});\r\n"]},"metadata":{},"sourceType":"module"}