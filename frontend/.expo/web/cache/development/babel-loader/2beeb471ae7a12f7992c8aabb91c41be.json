{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"D:\\\\projects\\\\cargo_app\\\\frontend\\\\src\\\\components\\\\roles\\\\dispatcher\\\\invoice\\\\invoice-form.js\";\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } it = o[Symbol.iterator](); return it.next.bind(it); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState } from \"react\";\nimport FormikField from \"../formik-field\";\nimport { Form, Formik } from \"formik\";\nimport ProductsTable from \"../products/products-table\";\nimport ProductDialog from \"../products/product-dialog\";\nimport { InvoiceFormValidation } from \"../../../parts/validation/invoice-form-validation\";\nimport { Button } from \"@material-ui/core\";\nimport useToast from \"../../../parts/toast-notification/useToast\";\nimport Paper from '@material-ui/core/Paper';\nimport { connect } from \"react-redux\";\nimport LibraryAddRoundedIcon from '@material-ui/icons/LibraryAddRounded';\nimport { DATA_FOR_INVOICE_CREATING_URL, handleRequestError, INVOICE_URL, makeRequest } from \"../../../parts/util/request-util\";\nimport \"../styles/invoice-form.css\";\nimport PersonSearch from \"./search-selectors/person-search\";\nimport Typography from \"@material-ui/core/Typography\";\nimport makeStyles from \"@material-ui/core/styles/makeStyles\";\nimport { UserInfo } from \"../../admin/user-info\";\nimport StorageSearch from \"./search-selectors/storage-search\";\nvar STORAGE_TITLE_SHIPPER = \"Shipper\";\nvar STORAGE_TITLE_CONSIGNEE = \"Consignee\";\nvar useStyles = makeStyles(function (theme) {\n  return {\n    infoPiece: {\n      flexDirection: \"column\",\n      alignItems: \"flex-start\"\n    },\n    boldText: {\n      fontWeight: \"bold\"\n    },\n    tableHeader: {\n      display: \"flex\",\n      flexDirection: \"row\",\n      justifyContent: \"center\",\n      marginTop: 5,\n      fontSize: 20\n    }\n  };\n});\nexport var EMPTY_MANAGER = {\n  id: -1,\n  name: \"\",\n  surname: \"\",\n  passport: \"\"\n};\nexport var EMPTY_DRIVER = {\n  id: -1,\n  name: \"\",\n  surname: \"\",\n  passport: \"\"\n};\nvar EMPTY_STORAGE = {\n  id: -1,\n  address: {\n    country: \"\",\n    city: \"\",\n    street: \"\",\n    house: \"\",\n    flat: \"\"\n  },\n  phone: \"\",\n  email: \"\"\n};\nexport var EMPTY_PRODUCT_OWNER = {\n  name: \"\",\n  type: \"Sole proprietorship\",\n  phone: \"\"\n};\nvar EMPTY_PRODUCT = {\n  id: -1,\n  name: \"\",\n  quantityMeasure: \"PIECE\",\n  quantity: \"\",\n  massMeasure: \"KG\",\n  mass: \"\",\n  price: \"\",\n  currency: \"BYN\"\n};\nvar INIT_INVOICE_STATE = {\n  number: \"\",\n  shipper: EMPTY_STORAGE,\n  consignee: EMPTY_STORAGE,\n  registrationDate: \"\",\n  driver: EMPTY_DRIVER,\n  manager: EMPTY_MANAGER,\n  productOwner: EMPTY_PRODUCT_OWNER,\n  products: []\n};\nvar TOTAL = {\n  BYN: 0,\n  USD: 0,\n  EURO: 0,\n  RUB: 0,\n  weight: 0,\n  quantity: 0\n};\n\nfunction InvoiceForm(props) {\n  var _this = this;\n\n  var styles = useStyles();\n  var onClose = props.onClose,\n      invoiceId = props.invoiceId,\n      openToast = props.openToast;\n\n  var _useState = useState(INIT_INVOICE_STATE),\n      _useState2 = _slicedToArray(_useState, 2),\n      initInvoice = _useState2[0],\n      setInitInvoice = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      drivers = _useState4[0],\n      setDrivers = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      managers = _useState6[0],\n      setManagers = _useState6[1];\n\n  var _useState7 = useState([]),\n      _useState8 = _slicedToArray(_useState7, 2),\n      storages = _useState8[0],\n      setStorages = _useState8[1];\n\n  var _useState9 = useState(EMPTY_PRODUCT),\n      _useState10 = _slicedToArray(_useState9, 2),\n      selectedProduct = _useState10[0],\n      setSelectedProduct = _useState10[1];\n\n  var _useState11 = useState(false),\n      _useState12 = _slicedToArray(_useState11, 2),\n      productDialogOpen = _useState12[0],\n      setProductDialogOpen = _useState12[1];\n\n  var _useState13 = useState(0),\n      _useState14 = _slicedToArray(_useState13, 2),\n      productIndex = _useState14[0],\n      setProductIndex = _useState14[1];\n\n  var _useToast = useToast(),\n      _useToast2 = _slicedToArray(_useToast, 2),\n      toastComponent = _useToast2[0],\n      showToastComponent = _useToast2[1];\n\n  var _useState15 = useState(TOTAL),\n      _useState16 = _slicedToArray(_useState15, 2),\n      total = _useState16[0],\n      setTotal = _useState16[1];\n\n  useEffect(function () {\n    updateDriversAndStoragesAndManagers();\n\n    if (invoiceId !== null && invoiceId !== undefined) {\n      fetchInitInvoiceState(invoiceId);\n    } else {\n      setEmptyInitInvoiceState();\n    }\n  }, [invoiceId, props.productOwner]);\n\n  var validateInvoice = function validateInvoice() {\n    if (initInvoice.consignee.id === -1) {\n      showToastComponent(\"Select consignee\", \"error\");\n      return false;\n    }\n\n    if (initInvoice.shipper.id === -1) {\n      showToastComponent(\"Select shipper\", \"error\");\n      return false;\n    }\n\n    if (initInvoice.shipper.id === initInvoice.consignee.id) {\n      showToastComponent(\"Consignee and shipper have the similar address\", \"error\");\n      return false;\n    }\n\n    if (initInvoice.driver.id === -1) {\n      showToastComponent(\"Select driver\", \"error\");\n      return false;\n    }\n\n    if (initInvoice.manager.id === -1) {\n      showToastComponent(\"Select manager\", \"error\");\n      return false;\n    }\n\n    return true;\n  };\n\n  var handleSubmit = function handleSubmit(values) {\n    var invoice = {};\n\n    if (!validateInvoice()) {\n      return;\n    }\n\n    invoice.invoiceNumber = values.invoiceNumber;\n    invoice.shipperId = initInvoice.shipper.id;\n    invoice.consigneeId = initInvoice.consignee.id;\n    invoice.productOwnerId = initInvoice.productOwner.id;\n    invoice.products = initInvoice.products;\n    invoice.registrationDate = initInvoice.registrationDate;\n    invoice.driverId = initInvoice.driver.id;\n    invoice.managerId = initInvoice.manager.id;\n    invoice.status = \"REGISTERED\";\n\n    if (props.invoiceId !== null && props.invoiceId !== undefined) {\n      invoice.id = props.invoiceId;\n      sendInvoiceForUpdate(invoice);\n    } else {\n      sendInvoiceForSave(invoice);\n    }\n  };\n\n  var handleClose = function handleClose() {\n    setInitInvoice(INIT_INVOICE_STATE);\n    setSelectedProduct(EMPTY_PRODUCT);\n    setProductIndex(0);\n    onClose();\n  };\n\n  var updateDriversAndStoragesAndManagers = function updateDriversAndStoragesAndManagers() {\n    var res;\n    return _regeneratorRuntime.async(function updateDriversAndStoragesAndManagers$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(makeRequest(\"GET\", DATA_FOR_INVOICE_CREATING_URL));\n\n          case 3:\n            res = _context.sent;\n            setDrivers(res.data.drivers);\n            setStorages(res.data.storages);\n            setManagers(res.data.managers);\n            _context.next = 13;\n            break;\n\n          case 9:\n            _context.prev = 9;\n            _context.t0 = _context[\"catch\"](0);\n            setDrivers([]);\n            handleRequestError(_context.t0, showToastComponent);\n\n          case 13:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 9]], Promise);\n  };\n\n  var sendInvoiceForSave = function sendInvoiceForSave(invoice) {\n    return _regeneratorRuntime.async(function sendInvoiceForSave$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(makeRequest(\"POST\", INVOICE_URL, invoice));\n\n          case 3:\n            openToast(\"Invoice has been saved\");\n            handleClose();\n            _context2.next = 10;\n            break;\n\n          case 7:\n            _context2.prev = 7;\n            _context2.t0 = _context2[\"catch\"](0);\n            handleRequestError(_context2.t0, showToastComponent);\n\n          case 10:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  var sendInvoiceForUpdate = function sendInvoiceForUpdate(invoice) {\n    return _regeneratorRuntime.async(function sendInvoiceForUpdate$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(makeRequest(\"PUT\", INVOICE_URL, invoice));\n\n          case 3:\n            openToast(\"Invoice has been updated\");\n            handleClose();\n            _context3.next = 10;\n            break;\n\n          case 7:\n            _context3.prev = 7;\n            _context3.t0 = _context3[\"catch\"](0);\n            handleRequestError(_context3.t0, showToastComponent);\n\n          case 10:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  var fetchInitInvoiceState = function fetchInitInvoiceState(id) {\n    var res, invoiceState;\n    return _regeneratorRuntime.async(function fetchInitInvoiceState$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.prev = 0;\n            _context4.next = 3;\n            return _regeneratorRuntime.awrap(makeRequest(\"GET\", INVOICE_URL + \"/\" + id));\n\n          case 3:\n            res = _context4.sent;\n            invoiceState = _objectSpread(_objectSpread({}, res.data), {}, {\n              productOwner: res.data.productOwnerDTO,\n              manager: res.data.checkingUser\n            });\n            invoiceState.productOwner.type = invoiceState.productOwner.type === \"SP\" ? \"Sole proprietorship\" : \"Juridical person\";\n            setInitInvoice(invoiceState);\n            _context4.next = 13;\n            break;\n\n          case 9:\n            _context4.prev = 9;\n            _context4.t0 = _context4[\"catch\"](0);\n            setInitInvoice(INIT_INVOICE_STATE);\n            handleRequestError(_context4.t0, showToastComponent);\n\n          case 13:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, [[0, 9]], Promise);\n  };\n\n  function setEmptyInitInvoiceState() {\n    setInitInvoice(function (prevState) {\n      var invoiceState = _objectSpread(_objectSpread({}, prevState), {}, {\n        registrationDate: new Date().toISOString().slice(0, 10),\n        productOwner: props.productOwner\n      });\n\n      invoiceState.productOwner.type = invoiceState.productOwner.type === \"SP\" ? \"Sole proprietorship\" : \"Juridical person\";\n      return invoiceState;\n    });\n  }\n\n  var handleProductDialogClose = function handleProductDialogClose() {\n    setSelectedProduct(EMPTY_PRODUCT);\n    setProductDialogOpen(false);\n  };\n\n  var handleProductDelete = function handleProductDelete(id) {\n    if (id !== -1) {\n      deleteProductById(id);\n    }\n  };\n\n  var handleProductDialogSubmit = function handleProductDialogSubmit(product) {\n    if (product.id === -1) {\n      addProduct(product);\n    } else {\n      updateProduct(product);\n    }\n\n    setSelectedProduct(EMPTY_PRODUCT);\n    setProductDialogOpen(false);\n  };\n\n  var handleCreateNewProductClick = function handleCreateNewProductClick() {\n    setSelectedProduct(EMPTY_PRODUCT);\n    setProductDialogOpen(true);\n  };\n\n  var handleProductTableClick = function handleProductTableClick(product) {\n    var isOpen = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    setSelectedProduct(product);\n    setProductDialogOpen(true);\n  };\n\n  var addProduct = function addProduct(product) {\n    product.id = productIndex;\n    setProductIndex(product.id + 1);\n    setInitInvoice(function (prevState) {\n      var temp = _toConsumableArray(prevState.products);\n\n      temp.push(product);\n      return _objectSpread(_objectSpread({}, prevState), {}, {\n        products: temp\n      });\n    });\n  };\n\n  var updateProduct = function updateProduct(newProduct) {\n    setInitInvoice(function (prevState) {\n      var temp = _toConsumableArray(prevState.products);\n\n      for (var _iterator = _createForOfIteratorHelperLoose(temp), _step; !(_step = _iterator()).done;) {\n        var el = _step.value;\n\n        if (el.id === newProduct.id) {\n          el.name = newProduct.name;\n          el.massMeasure = newProduct.massMeasure;\n          el.mass = newProduct.mass;\n          el.quantityMeasure = newProduct.quantityMeasure;\n          el.quantity = newProduct.quantity;\n          el.price = newProduct.price;\n          el.currency = newProduct.currency;\n        }\n      }\n\n      return _objectSpread(_objectSpread({}, prevState), {}, {\n        products: temp\n      });\n    });\n  };\n\n  var deleteProductById = function deleteProductById(id) {\n    setInitInvoice(function (prevState) {\n      var temp = _toConsumableArray(prevState.products);\n\n      for (var i = 0; i < temp.length; i++) {\n        if (temp[i].id === id) {\n          temp.splice(i, 1);\n        }\n      }\n\n      return _objectSpread(_objectSpread({}, prevState), {}, {\n        products: temp\n      });\n    });\n  };\n\n  var handleTotal = function handleTotal(total) {\n    setTotal(total);\n  };\n\n  var handleDriverSelect = function handleDriverSelect(driver) {\n    if (driver === null) {\n      setInitInvoice(function (prevState) {\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          driver: EMPTY_DRIVER\n        });\n      });\n    } else {\n      setInitInvoice(function (prevState) {\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          driver: driver\n        });\n      });\n    }\n  };\n\n  var handleManagerSelect = function handleManagerSelect(manager) {\n    if (manager === null) {\n      setInitInvoice(function (prevState) {\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          manager: EMPTY_DRIVER\n        });\n      });\n    } else {\n      setInitInvoice(function (prevState) {\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          manager: manager\n        });\n      });\n    }\n  };\n\n  var handleConsigneeSelect = function handleConsigneeSelect(storage, key) {\n    key = key.toLowerCase();\n\n    if (storage !== null) {\n      setInitInvoice(function (prevState) {\n        return _objectSpread(_objectSpread({}, prevState), {}, _defineProperty({}, key, storage));\n      });\n    } else {\n      setInitInvoice(function (prevState) {\n        return _objectSpread(_objectSpread({}, prevState), {}, _defineProperty({}, key, EMPTY_STORAGE));\n      });\n    }\n  };\n\n  return React.createElement(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 376,\n      columnNumber: 9\n    }\n  }, React.createElement(Formik, {\n    enableReinitialize: true,\n    initialValues: {\n      invoiceNumber: initInvoice.number\n    },\n    onSubmit: handleSubmit,\n    validationSchema: InvoiceFormValidation,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 377,\n      columnNumber: 13\n    }\n  }, function (formProps) {\n    return React.createElement(Form, {\n      className: \"invoice-form\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 386,\n        columnNumber: 21\n      }\n    }, React.createElement(\"div\", {\n      className: \"container-wrapper\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 25\n      }\n    }, React.createElement(\"div\", {\n      className: \"invoice-data-wrapper\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 388,\n        columnNumber: 29\n      }\n    }, React.createElement(\"div\", {\n      className: \"customer-data-wrapper\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 389,\n        columnNumber: 33\n      }\n    }, React.createElement(\"div\", {\n      className: \"left-div-wrapper\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 390,\n        columnNumber: 37\n      }\n    }, React.createElement(\"div\", {\n      className: \"customer-wrapper\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 391,\n        columnNumber: 41\n      }\n    }, React.createElement(Paper, {\n      elevation: 3,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 392,\n        columnNumber: 45\n      }\n    }, React.createElement(\"p\", {\n      className: \"div-title margin-0\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 49\n      }\n    }, \"Customer\"), React.createElement(\"div\", {\n      className: \"customer-paper\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 49\n      }\n    }, React.createElement(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 53\n      }\n    }, React.createElement(\"p\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 396,\n        columnNumber: 57\n      }\n    }, \"Company name\"), initInvoice.productOwner.name), React.createElement(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 399,\n        columnNumber: 53\n      }\n    }, React.createElement(\"p\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 400,\n        columnNumber: 57\n      }\n    }, \"Phone\"), initInvoice.productOwner.phone)))), React.createElement(\"div\", {\n      className: \"data-wrapper\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 406,\n        columnNumber: 41\n      }\n    }, React.createElement(Paper, {\n      elevation: 3,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 407,\n        columnNumber: 45\n      }\n    }, React.createElement(\"p\", {\n      className: \"div-title\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 408,\n        columnNumber: 49\n      }\n    }, \"Information\"), React.createElement(\"span\", {\n      className: \"invoice-input\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 409,\n        columnNumber: 49\n      }\n    }, React.createElement(FormikField, {\n      formikProps: formProps,\n      id: \"invoiceNumber\",\n      label: \"Invoice number\",\n      formikFieldName: \"invoiceNumber\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 410,\n        columnNumber: 49\n      }\n    })), React.createElement(StorageSearch, {\n      storages: storages,\n      onStorageSelect: handleConsigneeSelect,\n      prevStorage: initInvoice.consignee.id === -1 ? null : initInvoice.shipper,\n      title: STORAGE_TITLE_SHIPPER,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 419,\n        columnNumber: 49\n      }\n    }), React.createElement(StorageSearch, {\n      storages: storages,\n      onStorageSelect: handleConsigneeSelect,\n      prevStorage: initInvoice.consignee.id === -1 ? null : initInvoice.consignee,\n      title: STORAGE_TITLE_CONSIGNEE,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 426,\n        columnNumber: 49\n      }\n    }), React.createElement(PersonSearch, {\n      persons: drivers,\n      onPersonSelect: handleDriverSelect,\n      prevPerson: initInvoice.driver.id === -1 ? null : initInvoice.driver,\n      label: \"Drivers\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 433,\n        columnNumber: 49\n      }\n    }), React.createElement(PersonSearch, {\n      persons: managers,\n      onPersonSelect: handleManagerSelect,\n      prevPerson: initInvoice.manager.id === -1 ? null : initInvoice.manager,\n      label: \"Managers\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 439,\n        columnNumber: 49\n      }\n    }), React.createElement(\"div\", {\n      className: \"registration-date\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 445,\n        columnNumber: 49\n      }\n    }, React.createElement(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 446,\n        columnNumber: 53\n      }\n    }, React.createElement(\"p\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 447,\n        columnNumber: 57\n      }\n    }, \"Date of registration\"), initInvoice.registrationDate), React.createElement(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 450,\n        columnNumber: 53\n      }\n    }, React.createElement(\"p\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 451,\n        columnNumber: 57\n      }\n    }, \"Registration person\"), props.user.name + \" \" + props.user.surname))), initInvoice.id > 0 ? React.createElement(Paper, {\n      elevation: 3,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 458,\n        columnNumber: 49\n      }\n    }, React.createElement(\"p\", {\n      className: \"div-title\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 459,\n        columnNumber: 53\n      }\n    }, \"Comment\"), React.createElement(\"div\", {\n      style: {\n        marginBottom: 20\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 460,\n        columnNumber: 53\n      }\n    }, initInvoice.comment)) : \"\")), React.createElement(\"div\", {\n      className: \"right-div-wrapper\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 468,\n        columnNumber: 37\n      }\n    }, React.createElement(UserInfo, {\n      customUser: initInvoice.driver,\n      customClass: \"\",\n      title: \"Driver\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 469,\n        columnNumber: 41\n      }\n    }), React.createElement(UserInfo, {\n      customUser: initInvoice.manager === undefined ? initInvoice.checkingUser : initInvoice.manager,\n      customClass: \"\",\n      title: \"Manager\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 475,\n        columnNumber: 41\n      }\n    })))), React.createElement(\"div\", {\n      className: \"product-table-wrapper\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 483,\n        columnNumber: 29\n      }\n    }, React.createElement(\"div\", {\n      className: \"product-box\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 484,\n        columnNumber: 33\n      }\n    }, React.createElement(Typography, {\n      className: styles.tableHeader + \" margin-0\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 485,\n        columnNumber: 37\n      }\n    }, React.createElement(\"span\", {\n      className: \"div-title\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 486,\n        columnNumber: 41\n      }\n    }, \"CARGO LIST\")), React.createElement(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 488,\n        columnNumber: 37\n      }\n    }, \"Quantity: \", React.createElement(\"span\", {\n      className: \"strong-text\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 489,\n        columnNumber: 51\n      }\n    }, total.quantity)), React.createElement(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 491,\n        columnNumber: 37\n      }\n    }, \"Weight: \", React.createElement(\"span\", {\n      className: \"strong-text\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 492,\n        columnNumber: 49\n      }\n    }, total.weight + \" KG\")), React.createElement(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 494,\n        columnNumber: 37\n      }\n    }, \"Total sum:\", total.BYN === 0 ? \"\" : React.createElement(\"span\", {\n      className: \"strong-text\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 497,\n        columnNumber: 45\n      }\n    }, total.BYN, \" BYN\"), total.USD === 0 ? \"\" : React.createElement(\"span\", {\n      className: \"strong-text\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 499,\n        columnNumber: 45\n      }\n    }, total.USD, \" USD\"), total.EURO === 0 ? \"\" : React.createElement(\"span\", {\n      className: \"strong-text\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 501,\n        columnNumber: 45\n      }\n    }, total.EURO, \" EURO\"), total.RUB === 0 ? \"\" : React.createElement(\"span\", {\n      className: \"strong-text\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 503,\n        columnNumber: 45\n      }\n    }, total.RUB, \" RUB\"), total.BYN === 0 && total.USD === 0 && total.EURO === 0 && total.RUB === 0 ? React.createElement(\"span\", {\n      className: \"strong-text\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 505,\n        columnNumber: 45\n      }\n    }, \"0\") : \"\"), React.createElement(Button, {\n      variant: \"contained\",\n      color: \"primary\",\n      onClick: handleCreateNewProductClick,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 507,\n        columnNumber: 37\n      }\n    }, React.createElement(LibraryAddRoundedIcon, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 510,\n        columnNumber: 41\n      }\n    }))), React.createElement(ProductsTable, {\n      products: initInvoice.products,\n      onRowClick: handleProductTableClick,\n      onAddProduct: handleTotal,\n      onRowDelete: handleProductDelete,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 513,\n        columnNumber: 33\n      }\n    }))), React.createElement(\"div\", {\n      className: \"reg-btn\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 521,\n        columnNumber: 25\n      }\n    }, React.createElement(Button, {\n      variant: \"contained\",\n      color: \"primary\",\n      type: \"submit\",\n      disabled: formProps.listener,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 522,\n        columnNumber: 29\n      }\n    }, initInvoice.id > 0 ? \"Update invoice\" : \"Register invoice\")));\n  }), toastComponent, React.createElement(ProductDialog, {\n    open: productDialogOpen,\n    initProductState: selectedProduct,\n    onSubmit: handleProductDialogSubmit,\n    onClose: handleProductDialogClose,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 536,\n      columnNumber: 13\n    }\n  }));\n}\n\nvar mapStateToProps = function mapStateToProps(store) {\n  return {\n    user: store.user\n  };\n};\n\nexport default connect(mapStateToProps)(InvoiceForm);","map":{"version":3,"sources":["D:/projects/cargo_app/frontend/src/components/roles/dispatcher/invoice/invoice-form.js"],"names":["React","useEffect","useState","FormikField","Form","Formik","ProductsTable","ProductDialog","InvoiceFormValidation","Button","useToast","Paper","connect","LibraryAddRoundedIcon","DATA_FOR_INVOICE_CREATING_URL","handleRequestError","INVOICE_URL","makeRequest","PersonSearch","Typography","makeStyles","UserInfo","StorageSearch","STORAGE_TITLE_SHIPPER","STORAGE_TITLE_CONSIGNEE","useStyles","theme","infoPiece","flexDirection","alignItems","boldText","fontWeight","tableHeader","display","justifyContent","marginTop","fontSize","EMPTY_MANAGER","id","name","surname","passport","EMPTY_DRIVER","EMPTY_STORAGE","address","country","city","street","house","flat","phone","email","EMPTY_PRODUCT_OWNER","type","EMPTY_PRODUCT","quantityMeasure","quantity","massMeasure","mass","price","currency","INIT_INVOICE_STATE","number","shipper","consignee","registrationDate","driver","manager","productOwner","products","TOTAL","BYN","USD","EURO","RUB","weight","InvoiceForm","props","styles","onClose","invoiceId","openToast","initInvoice","setInitInvoice","drivers","setDrivers","managers","setManagers","storages","setStorages","selectedProduct","setSelectedProduct","productDialogOpen","setProductDialogOpen","productIndex","setProductIndex","toastComponent","showToastComponent","total","setTotal","updateDriversAndStoragesAndManagers","undefined","fetchInitInvoiceState","setEmptyInitInvoiceState","validateInvoice","handleSubmit","values","invoice","invoiceNumber","shipperId","consigneeId","productOwnerId","driverId","managerId","status","sendInvoiceForUpdate","sendInvoiceForSave","handleClose","res","data","invoiceState","productOwnerDTO","checkingUser","prevState","Date","toISOString","slice","handleProductDialogClose","handleProductDelete","deleteProductById","handleProductDialogSubmit","product","addProduct","updateProduct","handleCreateNewProductClick","handleProductTableClick","isOpen","temp","push","newProduct","el","i","length","splice","handleTotal","handleDriverSelect","handleManagerSelect","handleConsigneeSelect","storage","key","toLowerCase","formProps","user","marginBottom","comment","listener","mapStateToProps","store"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from \"react\";\r\nimport FormikField from \"../formik-field\"\r\nimport {Form, Formik} from \"formik\";\r\nimport ProductsTable from \"../products/products-table\";\r\nimport ProductDialog from \"../products/product-dialog\";\r\nimport {InvoiceFormValidation} from \"../../../parts/validation/invoice-form-validation\";\r\nimport {Button} from \"@material-ui/core\";\r\nimport useToast from \"../../../parts/toast-notification/useToast\";\r\nimport Paper from '@material-ui/core/Paper';\r\nimport {connect} from \"react-redux\";\r\nimport LibraryAddRoundedIcon from '@material-ui/icons/LibraryAddRounded';\r\nimport {\r\n    DATA_FOR_INVOICE_CREATING_URL,\r\n    handleRequestError,\r\n    INVOICE_URL,\r\n    makeRequest\r\n} from \"../../../parts/util/request-util\";\r\nimport \"../styles/invoice-form.css\"\r\nimport PersonSearch from \"./search-selectors/person-search\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport makeStyles from \"@material-ui/core/styles/makeStyles\";\r\nimport {UserInfo} from \"../../admin/user-info\";\r\nimport StorageSearch from \"./search-selectors/storage-search\";\r\n\r\n\r\nconst STORAGE_TITLE_SHIPPER = \"Shipper\";\r\nconst STORAGE_TITLE_CONSIGNEE = \"Consignee\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    infoPiece: {\r\n        flexDirection: \"column\",\r\n        alignItems: \"flex-start\"\r\n    },\r\n    boldText: {\r\n        fontWeight: \"bold\",\r\n    },\r\n    tableHeader: {\r\n        display: \"flex\",\r\n        flexDirection: \"row\",\r\n        justifyContent: \"center\",\r\n        marginTop: 5,\r\n        fontSize: 20\r\n    }\r\n}));\r\n\r\nexport const EMPTY_MANAGER = {\r\n    id: -1,\r\n    name: \"\",\r\n    surname: \"\",\r\n    passport: \"\",\r\n};\r\n\r\nexport const EMPTY_DRIVER = {\r\n    id: -1,\r\n    name: \"\",\r\n    surname: \"\",\r\n    passport: \"\",\r\n};\r\n\r\nconst EMPTY_STORAGE = {\r\n    id: -1,\r\n    address: {\r\n        country: \"\",\r\n        city: \"\",\r\n        street: \"\",\r\n        house: \"\",\r\n        flat: \"\",\r\n    },\r\n    phone: \"\",\r\n    email: \"\",\r\n}\r\n\r\nexport const EMPTY_PRODUCT_OWNER = {\r\n    name: \"\",\r\n    type: \"Sole proprietorship\",\r\n    phone: \"\",\r\n};\r\n\r\nconst EMPTY_PRODUCT = {\r\n    id: -1,\r\n    name: \"\",\r\n    quantityMeasure: \"PIECE\",\r\n    quantity: \"\",\r\n    massMeasure: \"KG\",\r\n    mass: \"\",\r\n    price: \"\",\r\n    currency: \"BYN\",\r\n};\r\n\r\nconst INIT_INVOICE_STATE = {\r\n    number: \"\",\r\n    shipper: EMPTY_STORAGE,\r\n    consignee: EMPTY_STORAGE,\r\n    registrationDate: \"\",\r\n    driver: EMPTY_DRIVER,\r\n    manager: EMPTY_MANAGER,\r\n    productOwner: EMPTY_PRODUCT_OWNER,\r\n    products: [],\r\n};\r\n\r\nconst TOTAL = {\r\n    BYN: 0,\r\n    USD: 0,\r\n    EURO: 0,\r\n    RUB: 0,\r\n    weight: 0,\r\n    quantity: 0\r\n};\r\n\r\nfunction InvoiceForm(props) {\r\n    const styles = useStyles();\r\n    const {onClose, invoiceId, openToast} = props;\r\n    const [initInvoice, setInitInvoice] = useState(INIT_INVOICE_STATE);\r\n\r\n    const [drivers, setDrivers] = useState([]);\r\n    const [managers, setManagers] = useState([]);\r\n    const [storages, setStorages] = useState([]);\r\n\r\n    const [selectedProduct, setSelectedProduct] = useState(EMPTY_PRODUCT);\r\n    const [productDialogOpen, setProductDialogOpen] = useState(false);\r\n    const [productIndex, setProductIndex] = useState(0);\r\n    const [toastComponent, showToastComponent] = useToast();\r\n    const [total, setTotal] = useState(TOTAL);\r\n\r\n    useEffect(() => {\r\n        updateDriversAndStoragesAndManagers();\r\n        if (invoiceId !== null && invoiceId !== undefined) {\r\n            fetchInitInvoiceState(invoiceId);\r\n        } else {\r\n            setEmptyInitInvoiceState();\r\n        }\r\n    }, [invoiceId, props.productOwner]);\r\n\r\n    const validateInvoice = () => {\r\n\r\n        if (initInvoice.consignee.id === -1) {\r\n            showToastComponent(\"Select consignee\", \"error\");\r\n            return false;\r\n        }\r\n\r\n        if (initInvoice.shipper.id === -1) {\r\n            showToastComponent(\"Select shipper\", \"error\");\r\n            return false;\r\n        }\r\n\r\n        if (initInvoice.shipper.id === initInvoice.consignee.id) {\r\n            showToastComponent(\"Consignee and shipper have the similar address\", \"error\");\r\n            return false;\r\n        }\r\n\r\n        if (initInvoice.driver.id === -1) {\r\n            showToastComponent(\"Select driver\", \"error\");\r\n            return false;\r\n        }\r\n\r\n\r\n        if (initInvoice.manager.id === -1) { // manager.id  or checkingUser?\r\n            showToastComponent(\"Select manager\", \"error\");\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    const handleSubmit = (values) => {\r\n        let invoice = {};\r\n\r\n        if (!validateInvoice()) {\r\n            return;\r\n        }\r\n\r\n        invoice.invoiceNumber = values.invoiceNumber;\r\n        invoice.shipperId = initInvoice.shipper.id;\r\n        invoice.consigneeId = initInvoice.consignee.id;\r\n        invoice.productOwnerId = initInvoice.productOwner.id;\r\n        invoice.products = initInvoice.products;\r\n        invoice.registrationDate = initInvoice.registrationDate;\r\n        invoice.driverId = initInvoice.driver.id;\r\n        invoice.managerId = initInvoice.manager.id; // manager.id  or checkingUser?\r\n        invoice.status = \"REGISTERED\";\r\n\r\n        if (props.invoiceId !== null && props.invoiceId !== undefined) {\r\n            invoice.id = props.invoiceId;\r\n            sendInvoiceForUpdate(invoice);\r\n        } else {\r\n            sendInvoiceForSave(invoice);\r\n        }\r\n    };\r\n\r\n    const handleClose = () => {\r\n        setInitInvoice(INIT_INVOICE_STATE);\r\n        setSelectedProduct(EMPTY_PRODUCT);\r\n        setProductIndex(0);\r\n\r\n        onClose();\r\n    };\r\n\r\n    const updateDriversAndStoragesAndManagers = async () => {\r\n        try {\r\n            const res = await makeRequest(\"GET\", DATA_FOR_INVOICE_CREATING_URL);\r\n            setDrivers(res.data.drivers);\r\n            setStorages(res.data.storages);\r\n            setManagers(res.data.managers);\r\n        } catch (error) {\r\n            setDrivers([]);\r\n            handleRequestError(error, showToastComponent);\r\n        }\r\n    };\r\n\r\n    const sendInvoiceForSave = async (invoice) => {\r\n        try {\r\n            await makeRequest(\"POST\", INVOICE_URL, invoice);\r\n            openToast(\"Invoice has been saved\");\r\n            handleClose();\r\n        } catch (error) {\r\n            handleRequestError(error, showToastComponent);\r\n        }\r\n    };\r\n\r\n    const sendInvoiceForUpdate = async (invoice) => {\r\n        try {\r\n            await makeRequest(\"PUT\", INVOICE_URL, invoice);\r\n            openToast(\"Invoice has been updated\");\r\n            handleClose();\r\n        } catch (error) {\r\n            handleRequestError(error, showToastComponent);\r\n        }\r\n    };\r\n\r\n    const fetchInitInvoiceState = async (id) => {\r\n        try {\r\n            const res = await makeRequest(\"GET\", INVOICE_URL + \"/\" + id);\r\n            let invoiceState = {\r\n                ...res.data,\r\n                productOwner: res.data.productOwnerDTO,\r\n                manager: res.data.checkingUser\r\n            };\r\n            invoiceState.productOwner.type = invoiceState.productOwner.type === \"SP\" ? \"Sole proprietorship\" : \"Juridical person\";\r\n            setInitInvoice(invoiceState);\r\n        } catch (error) {\r\n            setInitInvoice(INIT_INVOICE_STATE);\r\n            handleRequestError(error, showToastComponent);\r\n        }\r\n    };\r\n\r\n    function setEmptyInitInvoiceState() {\r\n        setInitInvoice((prevState) => {\r\n            let invoiceState = {\r\n                ...prevState,\r\n                registrationDate: new Date().toISOString().slice(0, 10),\r\n                productOwner: props.productOwner,\r\n            }\r\n            invoiceState.productOwner.type = invoiceState.productOwner.type === \"SP\" ? \"Sole proprietorship\" : \"Juridical person\";\r\n            return invoiceState;\r\n        });\r\n    }\r\n\r\n\r\n    const handleProductDialogClose = () => {\r\n        setSelectedProduct(EMPTY_PRODUCT);\r\n        setProductDialogOpen(false);\r\n    };\r\n\r\n    const handleProductDelete = (id) => {\r\n        if (id !== -1) {\r\n            deleteProductById(id);\r\n        }\r\n    };\r\n\r\n    const handleProductDialogSubmit = (product) => {\r\n        if (product.id === -1) {\r\n            addProduct(product);\r\n        } else {\r\n            updateProduct(product);\r\n        }\r\n        setSelectedProduct(EMPTY_PRODUCT);\r\n        setProductDialogOpen(false);\r\n    };\r\n\r\n    const handleCreateNewProductClick = () => {\r\n        setSelectedProduct(EMPTY_PRODUCT);\r\n        setProductDialogOpen(true);\r\n    };\r\n\r\n    const handleProductTableClick = (product, isOpen = true) => {\r\n        setSelectedProduct(product);\r\n        setProductDialogOpen(true);\r\n    };\r\n\r\n    const addProduct = (product) => {\r\n        product.id = productIndex;\r\n        setProductIndex(product.id + 1);\r\n        setInitInvoice((prevState) => {\r\n            const temp = [...prevState.products];\r\n            temp.push(product);\r\n            return {...prevState, products: temp};\r\n        });\r\n    };\r\n\r\n    const updateProduct = (newProduct) => {\r\n        setInitInvoice((prevState) => {\r\n            const temp = [...prevState.products];\r\n            for (let el of temp) {\r\n                if (el.id === newProduct.id) {\r\n                    el.name = newProduct.name;\r\n                    el.massMeasure = newProduct.massMeasure;\r\n                    el.mass = newProduct.mass;\r\n                    el.quantityMeasure = newProduct.quantityMeasure;\r\n                    el.quantity = newProduct.quantity;\r\n                    el.price = newProduct.price;\r\n                    el.currency = newProduct.currency;\r\n                }\r\n            }\r\n            return {...prevState, products: temp};\r\n        });\r\n    };\r\n\r\n    const deleteProductById = (id) => {\r\n        setInitInvoice((prevState) => {\r\n            const temp = [...prevState.products];\r\n            for (let i = 0; i < temp.length; i++) {\r\n                if (temp[i].id === id) {\r\n                    temp.splice(i, 1);\r\n                }\r\n            }\r\n            return {...prevState, products: temp};\r\n        });\r\n    };\r\n\r\n\r\n    const handleTotal = (total) => {\r\n        setTotal(total);\r\n    };\r\n\r\n    const handleDriverSelect = (driver) => {\r\n        if (driver === null) {\r\n            setInitInvoice((prevState) => {\r\n                return {...prevState, driver: EMPTY_DRIVER};\r\n            })\r\n        } else {\r\n            setInitInvoice((prevState) => {\r\n                return {...prevState, driver: driver};\r\n            })\r\n        }\r\n    }\r\n\r\n    const handleManagerSelect = (manager) => {\r\n        if (manager === null) {\r\n            setInitInvoice((prevState) => {\r\n                return {...prevState, manager: EMPTY_DRIVER};\r\n            })\r\n        } else {\r\n            setInitInvoice((prevState) => {\r\n                return {...prevState, manager: manager};\r\n            })\r\n        }\r\n    }\r\n\r\n    const handleConsigneeSelect = (storage, key) => {\r\n\r\n        key = key.toLowerCase();\r\n\r\n        if (storage !== null) {\r\n            setInitInvoice((prevState) => {\r\n                return {...prevState, [key]: storage};\r\n            })\r\n        } else {\r\n            setInitInvoice((prevState) => {\r\n                return {...prevState, [key]: EMPTY_STORAGE};\r\n            })\r\n        }\r\n    };\r\n\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <Formik\r\n                enableReinitialize\r\n                initialValues={{\r\n                    invoiceNumber: initInvoice.number,\r\n                }}\r\n                onSubmit={handleSubmit}\r\n                validationSchema={InvoiceFormValidation}\r\n            >\r\n                {(formProps) => (\r\n                    <Form className=\"invoice-form\">\r\n                        <div className=\"container-wrapper\">\r\n                            <div className=\"invoice-data-wrapper\">\r\n                                <div className=\"customer-data-wrapper\">\r\n                                    <div className=\"left-div-wrapper\">\r\n                                        <div className=\"customer-wrapper\">\r\n                                            <Paper elevation={3}>\r\n                                                <p className=\"div-title margin-0\">Customer</p>\r\n                                                <div className=\"customer-paper\">\r\n                                                    <div>\r\n                                                        <p>Company name</p>\r\n                                                        {initInvoice.productOwner.name}\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <p>Phone</p>\r\n                                                        {initInvoice.productOwner.phone}\r\n                                                    </div>\r\n                                                </div>\r\n                                            </Paper>\r\n                                        </div>\r\n                                        <div className=\"data-wrapper\">\r\n                                            <Paper elevation={3}>\r\n                                                <p className=\"div-title\">Information</p>\r\n                                                <span className=\"invoice-input\">\r\n                                                <FormikField\r\n                                                    formikProps={formProps}\r\n                                                    id={\"invoiceNumber\"}\r\n                                                    label={\"Invoice number\"}\r\n                                                    formikFieldName={\"invoiceNumber\"}\r\n\r\n                                                />\r\n                                                </span>\r\n\r\n                                                <StorageSearch\r\n                                                    storages={storages}\r\n                                                    onStorageSelect={handleConsigneeSelect}\r\n                                                    prevStorage={initInvoice.consignee.id === -1 ? null : initInvoice.shipper}\r\n                                                    title={STORAGE_TITLE_SHIPPER}\r\n                                                />\r\n\r\n                                                <StorageSearch\r\n                                                    storages={storages}\r\n                                                    onStorageSelect={handleConsigneeSelect}\r\n                                                    prevStorage={initInvoice.consignee.id === -1 ? null : initInvoice.consignee}\r\n                                                    title={STORAGE_TITLE_CONSIGNEE}\r\n                                                />\r\n\r\n                                                <PersonSearch\r\n                                                    persons={drivers}\r\n                                                    onPersonSelect={handleDriverSelect}\r\n                                                    prevPerson={initInvoice.driver.id === -1 ? null : initInvoice.driver}\r\n                                                    label={\"Drivers\"}\r\n                                                />\r\n                                                <PersonSearch\r\n                                                    persons={managers}\r\n                                                    onPersonSelect={handleManagerSelect}\r\n                                                    prevPerson={initInvoice.manager.id === -1 ? null : initInvoice.manager}\r\n                                                    label={\"Managers\"}\r\n                                                />\r\n                                                <div className=\"registration-date\">\r\n                                                    <div>\r\n                                                        <p>Date of registration</p>\r\n                                                        {initInvoice.registrationDate}\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <p>Registration person</p>\r\n                                                        {props.user.name + \" \" + props.user.surname}\r\n                                                    </div>\r\n                                                </div>\r\n                                            </Paper>\r\n\r\n                                            {initInvoice.id > 0 ?\r\n                                                <Paper elevation={3}>\r\n                                                    <p className=\"div-title\">Comment</p>\r\n                                                    <div style={{marginBottom: 20}}>\r\n                                                        {initInvoice.comment}\r\n                                                    </div>\r\n                                                </Paper>\r\n                                                : \"\"}\r\n\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"right-div-wrapper\">\r\n                                        <UserInfo\r\n                                            customUser={initInvoice.driver}\r\n                                            customClass={\"\"}\r\n                                            title={\"Driver\"}\r\n\r\n                                        />\r\n                                        <UserInfo\r\n                                            customUser={initInvoice.manager === undefined ? initInvoice.checkingUser : initInvoice.manager}\r\n                                            customClass={\"\"}\r\n                                            title={\"Manager\"}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"product-table-wrapper\">\r\n                                <div className=\"product-box\">\r\n                                    <Typography className={styles.tableHeader + \" margin-0\"}>\r\n                                        <span className=\"div-title\">CARGO LIST</span>\r\n                                    </Typography>\r\n                                    <div>\r\n                                        Quantity: <span className=\"strong-text\">{total.quantity}</span>\r\n                                    </div>\r\n                                    <div>\r\n                                        Weight: <span className=\"strong-text\">{total.weight + \" KG\"}</span>\r\n                                    </div>\r\n                                    <div>\r\n                                        Total sum:\r\n                                        {total.BYN === 0 ? \"\" :\r\n                                            <span className=\"strong-text\">{total.BYN} BYN</span>}\r\n                                        {total.USD === 0 ? \"\" :\r\n                                            <span className=\"strong-text\">{total.USD} USD</span>}\r\n                                        {total.EURO === 0 ? \"\" :\r\n                                            <span className=\"strong-text\">{total.EURO} EURO</span>}\r\n                                        {total.RUB === 0 ? \"\" :\r\n                                            <span className=\"strong-text\">{total.RUB} RUB</span>}\r\n                                        {total.BYN === 0 && total.USD === 0 && total.EURO === 0 && total.RUB === 0 ?\r\n                                            <span className=\"strong-text\">0</span> : \"\"}\r\n                                    </div>\r\n                                    <Button variant=\"contained\"\r\n                                            color=\"primary\"\r\n                                            onClick={handleCreateNewProductClick}>\r\n                                        <LibraryAddRoundedIcon/>\r\n                                    </Button>\r\n                                </div>\r\n                                <ProductsTable\r\n                                    products={initInvoice.products}\r\n                                    onRowClick={handleProductTableClick}\r\n                                    onAddProduct={handleTotal}\r\n                                    onRowDelete={handleProductDelete}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"reg-btn\">\r\n                            <Button\r\n                                variant=\"contained\"\r\n                                color=\"primary\"\r\n                                type=\"submit\"\r\n                                disabled={formProps.listener}\r\n                            >\r\n                                {initInvoice.id > 0 ? \"Update invoice\" : \"Register invoice\"}\r\n                            </Button>\r\n                        </div>\r\n\r\n                    </Form>\r\n                )}\r\n            </Formik>\r\n            {toastComponent}\r\n            <ProductDialog\r\n                open={productDialogOpen}\r\n                initProductState={selectedProduct}\r\n                onSubmit={handleProductDialogSubmit}\r\n                onClose={handleProductDialogClose}\r\n            />\r\n\r\n        </React.Fragment>\r\n    );\r\n}\r\n\r\nconst mapStateToProps = (store) => {\r\n    return {\r\n        user: store.user,\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps)(InvoiceForm);"]},"metadata":{},"sourceType":"module"}