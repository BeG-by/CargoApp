{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nvar _this = this,\n    _jsxFileName = \"D:\\\\projects\\\\cargo_app\\\\frontend\\\\src\\\\components\\\\roles\\\\manager\\\\calendar-table.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from \"react\";\nimport { Calendar, momentLocalizer } from 'react-big-calendar';\nimport moment from 'moment';\nimport withDragAndDrop from \"react-big-calendar/lib/addons/dragAndDrop\";\nimport { CALENDAR_URL, makeRequest, handleRequestError, WAYBILL_URL } from \"../../parts/util/request-util\";\nimport useToast from \"../../parts/toast-notification/useToast\";\nimport Button from \"@material-ui/core/Button\";\nimport \"react-big-calendar/lib/css/react-big-calendar.css\";\nimport \"react-big-calendar/lib/addons/dragAndDrop/styles.css\";\nimport \"./styles/calendar.css\";\nvar localizer = momentLocalizer(moment);\nvar DnDCalendar = withDragAndDrop(Calendar);\nvar eventStyle = {\n  color: \"black\"\n};\nvar inProcessStyle = {\n  style: _objectSpread(_objectSpread({}, eventStyle), {}, {\n    backgroundColor: \"#b0f7f7\"\n  })\n};\nvar notStartedStyle = {\n  style: _objectSpread(_objectSpread({}, eventStyle), {}, {\n    backgroundColor: \"#f7daad\"\n  })\n};\nvar completedStyle = {\n  style: _objectSpread(_objectSpread({}, eventStyle), {}, {\n    backgroundColor: \"#93faab\"\n  })\n};\nvar selectedStyle = {\n  style: {\n    backgroundColor: \"#4fa3f7\"\n  }\n};\nexport var CalendarTable = function CalendarTable() {\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      events = _useState2[0],\n      setEvents = _useState2[1];\n\n  var _useToast = useToast(),\n      _useToast2 = _slicedToArray(_useToast, 2),\n      toast = _useToast2[0],\n      openToast = _useToast2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      requestEvents = _useState4[0],\n      setRequestEvents = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      initEvents = _useState6[0],\n      setInitEvents = _useState6[1];\n\n  useEffect(function () {\n    getEvents();\n  }, []);\n\n  var getEvents = function getEvents() {\n    makeRequest(\"GET\", CALENDAR_URL).then(function (res) {\n      var eventsFromServer = transformInvoicesToEvents(res.data);\n      setEvents(eventsFromServer);\n      setInitEvents(eventsFromServer);\n    }).catch(function (error) {\n      return handleRequestError(error, openToast);\n    });\n  };\n\n  var onEventDropAndResize = function onEventDropAndResize(data) {\n    var event = data.event,\n        start = data.start,\n        end = data.end;\n    var today = new Date().getTime();\n\n    if (today > start || event.start < today) {\n      return;\n    }\n\n    var index = events.indexOf(event);\n\n    var updatedEvent = _objectSpread(_objectSpread({}, event), {}, {\n      start: start,\n      end: end\n    });\n\n    var copyEvents = _toConsumableArray(events);\n\n    copyEvents.splice(index, 1, updatedEvent);\n\n    var copyRequestEvent = _toConsumableArray(requestEvents);\n\n    var isExist = false;\n    copyRequestEvent.forEach(function (e) {\n      if (e.id === event.resource) {\n        e.start = new Date(start.getTime());\n        e.end = new Date(end.getTime());\n        isExist = true;\n      }\n    });\n\n    if (!isExist) {\n      copyRequestEvent.push({\n        id: event.resource,\n        start: new Date(start.getTime()),\n        end: new Date(end.getTime())\n      });\n    }\n\n    setRequestEvents(copyRequestEvent);\n    setEvents(copyEvents);\n  };\n\n  var propEvent = function propEvent(event, start, end, isSelected) {\n    var today = new Date().getTime();\n    start = start.getTime();\n    end = end.getTime();\n\n    if (isSelected) {\n      return selectedStyle;\n    }\n\n    if (today > start && today < end) {\n      return inProcessStyle;\n    } else if (today < start) {\n      return notStartedStyle;\n    } else if (today > end) {\n      return completedStyle;\n    }\n  };\n\n  var onCancel = function onCancel() {\n    setEvents(initEvents);\n    setRequestEvents([]);\n  };\n\n  var onSave = function onSave() {\n    if (requestEvents.length === 0) {\n      openToast(\"No changes\", \"info\");\n      return;\n    }\n\n    requestEvents.forEach(function (e) {\n      e.start.setDate(e.start.getDate() + 1);\n    });\n    makeRequest(\"PUT\", WAYBILL_URL, requestEvents).then(function (res) {\n      openToast(\"Waybills has been updated\", \"success\");\n      setInitEvents(events);\n      setRequestEvents([]);\n    }).catch(function (error) {\n      return handleRequestError(error, openToast);\n    });\n  };\n\n  return React.createElement(\"main\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 9\n    }\n  }, React.createElement(\"div\", {\n    className: \"calendar-wrapper\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 13\n    }\n  }, React.createElement(DnDCalendar, {\n    localizer: localizer,\n    events: events,\n    startAccessor: \"start\",\n    endAccessor: \"end\",\n    views: [\"month\", \"day\"],\n    onEventDrop: onEventDropAndResize,\n    onEventResize: onEventDropAndResize,\n    eventPropGetter: propEvent,\n    resizable: true,\n    selectable: true,\n    style: {\n      fontFamily: \"Roboto sans-serif\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 17\n    }\n  })), React.createElement(\"div\", {\n    className: \"direction-col\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 13\n    }\n  }, React.createElement(\"div\", {\n    className: \"notice\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 17\n    }\n  }, React.createElement(\"div\", {\n    className: \"inline\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 21\n    }\n  }, React.createElement(\"div\", {\n    className: \"not-started-ev\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 25\n    }\n  }), React.createElement(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 25\n    }\n  }, \" - future waybill\")), React.createElement(\"div\", {\n    className: \"inline\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 21\n    }\n  }, React.createElement(\"div\", {\n    className: \"current-ev\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 25\n    }\n  }), React.createElement(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 25\n    }\n  }, \" - current waybill\")), React.createElement(\"div\", {\n    className: \"inline\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 21\n    }\n  }, React.createElement(\"div\", {\n    className: \"completed-ev\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 25\n    }\n  }), React.createElement(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 25\n    }\n  }, \" - completed waybill\"))), React.createElement(\"div\", {\n    className: \"btn-div\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 17\n    }\n  }, React.createElement(Button, {\n    variant: \"contained\",\n    color: \"primary\",\n    type: \"submit\",\n    onClick: onSave,\n    style: {\n      fontSize: 18,\n      textTransform: \"none\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 21\n    }\n  }, \"Save\"), React.createElement(Button, {\n    variant: \"contained\",\n    color: \"primary\",\n    onClick: onCancel,\n    style: {\n      fontSize: 18,\n      textTransform: \"none\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 21\n    }\n  }, \"Cancel\"))), toast);\n};\n\nvar transformInvoicesToEvents = function transformInvoicesToEvents(invoices) {\n  var events = [];\n  invoices.forEach(function (i) {\n    if (i.waybill !== null) {\n      var title = i.number + \" \" + i.driver.name + \" \" + i.driver.patronymic;\n      var departureArr = i.waybill.departureDate.split(\"-\");\n      var arrivalArr = i.waybill.arrivalDate.split(\"-\");\n      var event = {\n        title: title,\n        start: new Date(departureArr[0], departureArr[1] - 1, departureArr[2]),\n        end: new Date(arrivalArr[0], arrivalArr[1] - 1, Number(arrivalArr[2]) + 1),\n        allDay: true,\n        resource: i.waybill.id\n      };\n      events.push(event);\n    }\n  });\n  return events;\n};","map":{"version":3,"sources":["D:/projects/cargo_app/frontend/src/components/roles/manager/calendar-table.js"],"names":["React","useState","useEffect","Calendar","momentLocalizer","moment","withDragAndDrop","CALENDAR_URL","makeRequest","handleRequestError","WAYBILL_URL","useToast","Button","localizer","DnDCalendar","eventStyle","color","inProcessStyle","style","backgroundColor","notStartedStyle","completedStyle","selectedStyle","CalendarTable","events","setEvents","toast","openToast","requestEvents","setRequestEvents","initEvents","setInitEvents","getEvents","then","res","eventsFromServer","transformInvoicesToEvents","data","catch","error","onEventDropAndResize","event","start","end","today","Date","getTime","index","indexOf","updatedEvent","copyEvents","splice","copyRequestEvent","isExist","forEach","e","id","resource","push","propEvent","isSelected","onCancel","onSave","length","setDate","getDate","fontFamily","fontSize","textTransform","invoices","i","waybill","title","number","driver","name","patronymic","departureArr","departureDate","split","arrivalArr","arrivalDate","Number","allDay"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from \"react\";\r\nimport {Calendar, momentLocalizer} from 'react-big-calendar';\r\nimport moment from 'moment';\r\nimport withDragAndDrop from \"react-big-calendar/lib/addons/dragAndDrop\";\r\nimport {CALENDAR_URL, makeRequest, handleRequestError, WAYBILL_URL} from \"../../parts/util/request-util\";\r\nimport useToast from \"../../parts/toast-notification/useToast\";\r\nimport Button from \"@material-ui/core/Button\";\r\n\r\nimport \"react-big-calendar/lib/css/react-big-calendar.css\";\r\nimport \"react-big-calendar/lib/addons/dragAndDrop/styles.css\";\r\nimport \"./styles/calendar.css\";\r\n\r\nconst localizer = momentLocalizer(moment);\r\nconst DnDCalendar = withDragAndDrop(Calendar);\r\n\r\n\r\nconst eventStyle = {\r\n    color: \"black\"\r\n};\r\n\r\n\r\nconst inProcessStyle = {\r\n    style: {\r\n        ...eventStyle,\r\n        backgroundColor: \"#b0f7f7\",\r\n    }\r\n};\r\n\r\nconst notStartedStyle = {\r\n    style: {\r\n        ...eventStyle,\r\n        backgroundColor: \"#f7daad\"\r\n    }\r\n};\r\n\r\nconst completedStyle = {\r\n    style: {\r\n        ...eventStyle,\r\n        backgroundColor: \"#93faab\"\r\n    }\r\n\r\n};\r\n\r\nconst selectedStyle = {\r\n    style: {\r\n        backgroundColor: \"#4fa3f7\"\r\n    }\r\n};\r\n\r\n\r\nexport const CalendarTable = () => {\r\n\r\n    const [events, setEvents] = useState([]);\r\n    const [toast, openToast] = useToast();\r\n\r\n    const [requestEvents, setRequestEvents] = useState([]);\r\n    const [initEvents, setInitEvents] = useState([]);\r\n\r\n\r\n    useEffect(() => {\r\n        getEvents()\r\n    }, []);\r\n\r\n    const getEvents = () => {\r\n        makeRequest(\"GET\", CALENDAR_URL)\r\n            .then(res => {\r\n                    let eventsFromServer = transformInvoicesToEvents(res.data);\r\n                    setEvents(eventsFromServer);\r\n                    setInitEvents(eventsFromServer);\r\n                }\r\n            )\r\n            .catch(error => handleRequestError(error, openToast))\r\n    };\r\n\r\n\r\n    const onEventDropAndResize = (data) => {\r\n\r\n        const {event, start, end} = data;\r\n        const today = new Date().getTime();\r\n\r\n        if (today > start || event.start < today) {\r\n            return;\r\n        }\r\n\r\n        const index = events.indexOf(event);\r\n        const updatedEvent = {...event, start: start, end: end}\r\n\r\n        const copyEvents = [...events];\r\n        copyEvents.splice(index, 1, updatedEvent);\r\n\r\n        const copyRequestEvent = [...requestEvents];\r\n        let isExist = false;\r\n\r\n        copyRequestEvent.forEach(e => {\r\n            if (e.id === event.resource) {\r\n                e.start = new Date(start.getTime());\r\n                e.end = new Date(end.getTime());\r\n                isExist = true;\r\n            }\r\n        });\r\n\r\n        if (!isExist) {\r\n            copyRequestEvent.push({id: event.resource, start: new Date(start.getTime()), end: new Date(end.getTime())});\r\n        }\r\n\r\n        setRequestEvents(copyRequestEvent);\r\n        setEvents(copyEvents);\r\n\r\n    };\r\n\r\n    const propEvent = (event, start, end, isSelected) => {\r\n\r\n        const today = new Date().getTime();\r\n        start = start.getTime();\r\n        end = end.getTime();\r\n\r\n        if (isSelected) {\r\n            return selectedStyle;\r\n        }\r\n\r\n        if (today > start && today < end) {\r\n            return inProcessStyle\r\n        } else if (today < start) {\r\n            return notStartedStyle\r\n        } else if (today > end) {\r\n            return completedStyle\r\n        }\r\n\r\n    };\r\n\r\n\r\n    const onCancel = () => {\r\n        setEvents(initEvents);\r\n        setRequestEvents([]);\r\n    };\r\n\r\n    const onSave = () => {\r\n\r\n        if (requestEvents.length === 0) {\r\n            openToast(\"No changes\", \"info\");\r\n            return;\r\n        }\r\n\r\n        requestEvents.forEach(e => {\r\n            e.start.setDate(e.start.getDate() + 1);\r\n        });\r\n\r\n        makeRequest(\"PUT\", WAYBILL_URL, requestEvents)\r\n            .then(res => {\r\n                openToast(\"Waybills has been updated\", \"success\");\r\n                setInitEvents(events);\r\n                setRequestEvents([])\r\n            })\r\n            .catch(error => handleRequestError(error, openToast));\r\n\r\n    };\r\n\r\n\r\n    return (\r\n        <main>\r\n            <div className=\"calendar-wrapper\">\r\n                <DnDCalendar\r\n                    localizer={localizer}\r\n                    events={events}\r\n                    startAccessor=\"start\"\r\n                    endAccessor=\"end\"\r\n                    views={[\"month\", \"day\"]}\r\n                    onEventDrop={onEventDropAndResize}\r\n                    onEventResize={onEventDropAndResize}\r\n                    eventPropGetter={propEvent}\r\n                    resizable\r\n                    selectable\r\n                    style={{fontFamily: \"Roboto sans-serif\"}}\r\n                />\r\n            </div>\r\n            <div className={\"direction-col\"}>\r\n                <div className={\"notice\"}>\r\n                    <div className={\"inline\"}>\r\n                        <div className={\"not-started-ev\"}/>\r\n                        <span> - future waybill</span>\r\n                    </div>\r\n                    <div className={\"inline\"}>\r\n                        <div className={\"current-ev\"}/>\r\n                        <span> - current waybill</span>\r\n                    </div>\r\n                    <div className={\"inline\"}>\r\n                        <div className={\"completed-ev\"}/>\r\n                        <span> - completed waybill</span>\r\n                    </div>\r\n                </div>\r\n                <div className={\"btn-div\"}>\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        color=\"primary\"\r\n                        type=\"submit\"\r\n                        onClick={onSave}\r\n                        style={{fontSize: 18, textTransform: \"none\"}}\r\n                    >\r\n                        Save\r\n                    </Button>\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        color=\"primary\"\r\n                        onClick={onCancel}\r\n                        style={{fontSize: 18, textTransform: \"none\"}}\r\n                    >\r\n                        Cancel\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n            {toast}\r\n        </main>\r\n\r\n\r\n    )\r\n\r\n};\r\n\r\n\r\nconst transformInvoicesToEvents = (invoices) => {\r\n\r\n    const events = [];\r\n\r\n    invoices.forEach(i => {\r\n\r\n        if (i.waybill !== null) {\r\n            const title = i.number + \" \" + i.driver.name + \" \" + i.driver.patronymic;\r\n            const departureArr = i.waybill.departureDate.split(\"-\");\r\n            const arrivalArr = i.waybill.arrivalDate.split(\"-\");\r\n\r\n            const event = {\r\n                title: title,\r\n                start: new Date(departureArr[0], departureArr[1] - 1, departureArr[2]),\r\n                end: new Date(arrivalArr[0], arrivalArr[1] - 1, Number(arrivalArr[2]) + 1),\r\n                allDay: true,\r\n                resource: i.waybill.id\r\n            };\r\n            events.push(event);\r\n        }\r\n    });\r\n\r\n    return events;\r\n\r\n};\r\n"]},"metadata":{},"sourceType":"module"}