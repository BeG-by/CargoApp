{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"D:\\\\projects\\\\cargo_app\\\\frontend\\\\src\\\\components\\\\roles\\\\manager\\\\invoice-info.js\";\n\nimport React, { useEffect } from \"react\";\nimport { OkButton } from \"../../parts/buttons/ok-button\";\nimport { DialogWindow } from \"../../parts/dialogs/dialog\";\nimport { RejectVerificationInvoice } from \"../../parts/dialogs/verify-invoice\";\nimport { AssignVerificationInvoice } from \"../../parts/dialogs/verify-invoice\";\nimport { getInvoiceById } from \"./request-utils\";\nimport InvoiceInfoContent from \"./invoice-info-content\";\nimport { CloseInvoice } from \"../../parts/dialogs/close-invoice\";\nimport { connect } from \"react-redux\";\nimport { EditInvoice } from \"../../parts/dialogs/edit-invoice\";\n\nvar mapStateToProps = function mapStateToProps(store) {\n  return {\n    role: store.user.roles[0]\n  };\n};\n\nexport var InvoiceInfo = connect(mapStateToProps)(function (props) {\n  var _React$useState = React.useState(null),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      form = _React$useState2[0],\n      setForm = _React$useState2[1];\n\n  var _React$useState3 = React.useState(false),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      openVerifyDialog = _React$useState4[0],\n      setOpenVerifyDialog = _React$useState4[1];\n\n  var _React$useState5 = React.useState(false),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      openRejectDialog = _React$useState6[0],\n      setOpenRejectDialog = _React$useState6[1];\n\n  var _React$useState7 = React.useState(false),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      openCloseDialog = _React$useState8[0],\n      setOpenCloseDialog = _React$useState8[1];\n\n  var _React$useState9 = React.useState(false),\n      _React$useState10 = _slicedToArray(_React$useState9, 2),\n      openEditDialog = _React$useState10[0],\n      setOpenEditDialog = _React$useState10[1];\n\n  var _React$useState11 = React.useState({\n    id: 0,\n    status: \"\",\n    products: [],\n    number: \"\",\n    registrationDate: \"\",\n    checkingDate: \"\",\n    closeDate: \"\",\n    shipper: {\n      address: {}\n    },\n    consignee: {\n      address: {}\n    },\n    driver: {\n      id: 0,\n      name: \"\",\n      surname: \"\"\n    },\n    registrationUser: {\n      id: 0\n    },\n    checkingUser: {\n      id: 0\n    },\n    comment: \"\",\n    waybill: {},\n    act: {},\n    productOwnerDTO: {}\n  }),\n      _React$useState12 = _slicedToArray(_React$useState11, 2),\n      invoice = _React$useState12[0],\n      setInvoice = _React$useState12[1];\n\n  var _React$useState13 = React.useState(true),\n      _React$useState14 = _slicedToArray(_React$useState13, 2),\n      checkPassage = _React$useState14[0],\n      setCheckPassage = _React$useState14[1];\n\n  var closeAllInnerDialogs = function closeAllInnerDialogs() {\n    setOpenVerifyDialog(false);\n    setOpenRejectDialog(false);\n    setOpenCloseDialog(false);\n    setOpenEditDialog(false);\n  };\n\n  var closeInvoiceDialog = function closeInvoiceDialog() {\n    closeAllInnerDialogs();\n    props.onClose();\n  };\n\n  var handleVerifyOpen = function handleVerifyOpen() {\n    var form = React.createElement(AssignVerificationInvoice, {\n      onClose: closeAllInnerDialogs,\n      onAssign: closeInvoiceDialog,\n      invoice: invoice,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 57,\n        columnNumber: 22\n      }\n    });\n    setForm(form);\n    setOpenVerifyDialog(true);\n  };\n\n  var handleRejectOpen = function handleRejectOpen() {\n    var form = React.createElement(RejectVerificationInvoice, {\n      onClose: closeAllInnerDialogs,\n      onReject: closeInvoiceDialog,\n      invoice: invoice,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 22\n      }\n    });\n    setForm(form);\n    setOpenRejectDialog(true);\n  };\n\n  var handleCloseOpen = function handleCloseOpen() {\n    var form = React.createElement(CloseInvoice, {\n      onClose: closeAllInnerDialogs,\n      onCloseInvoice: closeInvoiceDialog,\n      invoice: invoice,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 22\n      }\n    });\n    setForm(form);\n    setOpenCloseDialog(true);\n  };\n\n  var handleEditOpen = function handleEditOpen() {\n    var form = React.createElement(EditInvoice, {\n      handleClose: closeAllInnerDialogs,\n      invoice: invoice,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 22\n      }\n    });\n    setForm(form);\n    setOpenEditDialog(true);\n  };\n\n  function fetchInvoice(cleanupFunction) {\n    var selected;\n    return _regeneratorRuntime.async(function fetchInvoice$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(getInvoiceById(props.invoiceId));\n\n          case 2:\n            selected = _context.sent;\n            if (!cleanupFunction) setInvoice({\n              id: selected.id,\n              status: selected.status,\n              products: selected.products,\n              number: selected.number,\n              registrationDate: selected.registrationDate,\n              checkingDate: selected.checkingDate,\n              closeDate: selected.closeDate,\n              shipper: selected.shipper,\n              consignee: selected.consignee,\n              driver: selected.driver,\n              registrationUser: selected.registrationUser,\n              checkingUser: selected.checkingUser,\n              waybill: selected.waybill,\n              act: selected.act,\n              comment: selected.comment,\n              productOwnerDTO: selected.productOwnerDTO\n            });\n\n            if (selected.waybill === null) {\n              setCheckPassage(false);\n            } else {\n              selected.waybill.points.forEach(function (p) {\n                if (!p.passed) setCheckPassage(false);\n              });\n            }\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  useEffect(function () {\n    var cleanupFunction = false;\n    fetchInvoice(cleanupFunction);\n    return function () {\n      return cleanupFunction = true;\n    };\n  }, []);\n  var status = invoice.status;\n  var verifyDisabled = false;\n  var rejectDisabled = false;\n  var closeDisabled = false;\n  var editDisabled = false;\n\n  if (status.trim() === 'REGISTERED' && props.role === \"MANAGER\") {\n    closeDisabled = true;\n  } else if (status.trim() === 'ACCEPTED' && checkPassage && props.role === \"DRIVER\") {\n    verifyDisabled = true;\n    rejectDisabled = true;\n  } else if (status.trim() === 'REJECTED' && props.role === \"DISPATCHER\") {\n    verifyDisabled = true;\n    rejectDisabled = true;\n    closeDisabled = true;\n  } else {\n    verifyDisabled = true;\n    rejectDisabled = true;\n    closeDisabled = true;\n  }\n\n  var buttons = React.createElement(\"div\", {\n    className: \"btn-row\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 19\n    }\n  }, React.createElement(OkButton, {\n    content: 'Verify',\n    handleClick: handleVerifyOpen,\n    disabled: verifyDisabled,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 9\n    }\n  }), React.createElement(OkButton, {\n    content: 'Reject',\n    handleClick: handleRejectOpen,\n    disabled: rejectDisabled,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 9\n    }\n  }), React.createElement(OkButton, {\n    content: 'Close',\n    handleClick: handleCloseOpen,\n    disabled: closeDisabled,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 9\n    }\n  }));\n  return React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 9\n    }\n  }, React.createElement(InvoiceInfoContent, {\n    invoice: invoice,\n    buttons: buttons,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 13\n    }\n  }), React.createElement(DialogWindow, {\n    dialogTitle: \"Verification\",\n    handleClose: closeAllInnerDialogs,\n    openDialog: openVerifyDialog,\n    form: form,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 13\n    }\n  }), React.createElement(DialogWindow, {\n    dialogTitle: \"Rejection\",\n    handleClose: closeAllInnerDialogs,\n    openDialog: openRejectDialog,\n    form: form,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 13\n    }\n  }), React.createElement(DialogWindow, {\n    dialogTitle: \"Closing\",\n    handleClose: closeAllInnerDialogs,\n    openDialog: openCloseDialog,\n    form: form,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 13\n    }\n  }), React.createElement(DialogWindow, {\n    dialogTitle: \"Editing\",\n    handleClose: closeAllInnerDialogs,\n    openDialog: openEditDialog,\n    form: form,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 13\n    }\n  }));\n});","map":{"version":3,"sources":["D:/projects/cargo_app/frontend/src/components/roles/manager/invoice-info.js"],"names":["React","useEffect","OkButton","DialogWindow","RejectVerificationInvoice","AssignVerificationInvoice","getInvoiceById","InvoiceInfoContent","CloseInvoice","connect","EditInvoice","mapStateToProps","store","role","user","roles","InvoiceInfo","props","useState","form","setForm","openVerifyDialog","setOpenVerifyDialog","openRejectDialog","setOpenRejectDialog","openCloseDialog","setOpenCloseDialog","openEditDialog","setOpenEditDialog","id","status","products","number","registrationDate","checkingDate","closeDate","shipper","address","consignee","driver","name","surname","registrationUser","checkingUser","comment","waybill","act","productOwnerDTO","invoice","setInvoice","checkPassage","setCheckPassage","closeAllInnerDialogs","closeInvoiceDialog","onClose","handleVerifyOpen","handleRejectOpen","handleCloseOpen","handleEditOpen","fetchInvoice","cleanupFunction","invoiceId","selected","points","forEach","p","passed","verifyDisabled","rejectDisabled","closeDisabled","editDisabled","trim","buttons"],"mappings":"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","sourcesContent":["import React, {useEffect} from \"react\";\r\nimport {OkButton} from \"../../parts/buttons/ok-button\";\r\nimport {DialogWindow} from \"../../parts/dialogs/dialog\";\r\nimport {RejectVerificationInvoice} from \"../../parts/dialogs/verify-invoice\";\r\nimport {AssignVerificationInvoice} from \"../../parts/dialogs/verify-invoice\";\r\nimport {getInvoiceById} from \"./request-utils\";\r\nimport InvoiceInfoContent from \"./invoice-info-content\";\r\nimport {CloseInvoice} from \"../../parts/dialogs/close-invoice\";\r\nimport {connect} from \"react-redux\";\r\nimport {EditInvoice} from \"../../parts/dialogs/edit-invoice\";\r\n\r\nconst mapStateToProps = (store) => {\r\n    return {\r\n        role: store.user.roles[0]\r\n    }\r\n};\r\n\r\nexport const InvoiceInfo = connect(mapStateToProps)((props) => {\r\n    const [form, setForm] = React.useState(null);\r\n    const [openVerifyDialog, setOpenVerifyDialog] = React.useState(false);\r\n    const [openRejectDialog, setOpenRejectDialog] = React.useState(false);\r\n    const [openCloseDialog, setOpenCloseDialog] = React.useState(false);\r\n    const [openEditDialog, setOpenEditDialog] = React.useState(false);\r\n    const [invoice, setInvoice] = React.useState({\r\n        id: 0,\r\n        status: \"\",\r\n        products: [],\r\n        number: \"\",\r\n        registrationDate: \"\",\r\n        checkingDate: \"\",\r\n        closeDate: \"\",\r\n        shipper: {address:{}},\r\n        consignee: {address: {}},\r\n        driver: {id: 0, name: \"\", surname: \"\"},\r\n        registrationUser: {id: 0},\r\n        checkingUser: {id: 0},\r\n        comment: \"\",\r\n        waybill: {},\r\n        act: {},\r\n        productOwnerDTO: {}\r\n    });\r\n    const [checkPassage, setCheckPassage] = React.useState(true);\r\n\r\n    const closeAllInnerDialogs = () => {\r\n        setOpenVerifyDialog(false);\r\n        setOpenRejectDialog(false);\r\n        setOpenCloseDialog(false);\r\n        setOpenEditDialog(false);\r\n    };\r\n\r\n    const closeInvoiceDialog = () => {\r\n        closeAllInnerDialogs();\r\n        props.onClose();\r\n    }\r\n\r\n    const handleVerifyOpen = () => {\r\n        const form = <AssignVerificationInvoice\r\n            onClose={closeAllInnerDialogs}\r\n            onAssign={closeInvoiceDialog}\r\n            invoice={invoice}\r\n        />\r\n        setForm(form);\r\n        setOpenVerifyDialog(true);\r\n    }\r\n\r\n    const handleRejectOpen = () => {\r\n        const form = <RejectVerificationInvoice\r\n            onClose={closeAllInnerDialogs}\r\n            onReject={closeInvoiceDialog}\r\n            invoice={invoice}/>\r\n        setForm(form);\r\n        setOpenRejectDialog(true);\r\n    }\r\n\r\n    const handleCloseOpen = () => {\r\n        const form = <CloseInvoice\r\n            onClose={closeAllInnerDialogs}\r\n            onCloseInvoice={closeInvoiceDialog}\r\n            invoice={invoice}/>\r\n        setForm(form);\r\n        setOpenCloseDialog(true);\r\n    }\r\n\r\n    const handleEditOpen = () => {\r\n        const form = <EditInvoice\r\n            handleClose={closeAllInnerDialogs}\r\n            invoice={invoice}/>\r\n        setForm(form);\r\n        setOpenEditDialog(true);\r\n    }\r\n\r\n    async function fetchInvoice(cleanupFunction) {\r\n        let selected = await getInvoiceById(props.invoiceId);\r\n        if (!cleanupFunction) setInvoice({\r\n            id: selected.id,\r\n            status: selected.status,\r\n            products: selected.products,\r\n            number: selected.number,\r\n            registrationDate: selected.registrationDate,\r\n            checkingDate: selected.checkingDate,\r\n            closeDate: selected.closeDate,\r\n            shipper: selected.shipper,\r\n            consignee: selected.consignee,\r\n            driver: selected.driver,\r\n            registrationUser: selected.registrationUser,\r\n            checkingUser: selected.checkingUser,\r\n            waybill: selected.waybill,\r\n            act: selected.act,\r\n            comment: selected.comment,\r\n            productOwnerDTO: selected.productOwnerDTO,\r\n        });\r\n        if (selected.waybill === null) {\r\n            setCheckPassage(false);\r\n        } else {\r\n            selected.waybill.points.forEach(p => {\r\n                if (!p.passed) setCheckPassage(false);\r\n            })\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        let cleanupFunction = false;\r\n        fetchInvoice(cleanupFunction);\r\n        return () => cleanupFunction = true;\r\n    }, []);\r\n\r\n    let status = invoice.status;\r\n    let verifyDisabled = false;\r\n    let rejectDisabled = false;\r\n    let closeDisabled = false;\r\n    let editDisabled = false;\r\n\r\n    if (status.trim() === 'REGISTERED' && props.role === \"MANAGER\") {\r\n        closeDisabled = true;\r\n    } else if (status.trim() === 'ACCEPTED' && checkPassage && props.role === \"DRIVER\") {\r\n        verifyDisabled = true;\r\n        rejectDisabled = true;\r\n    } else if (status.trim() === 'REJECTED' && props.role === \"DISPATCHER\") {\r\n        verifyDisabled = true;\r\n        rejectDisabled = true;\r\n        closeDisabled = true;\r\n    } else {\r\n        verifyDisabled = true;\r\n        rejectDisabled = true;\r\n        closeDisabled = true;\r\n    }\r\n\r\n    let buttons = <div className='btn-row'>\r\n        <OkButton content={'Verify'} handleClick={handleVerifyOpen} disabled={verifyDisabled}/>\r\n        <OkButton content={'Reject'} handleClick={handleRejectOpen} disabled={rejectDisabled}/>\r\n        <OkButton content={'Close'} handleClick={handleCloseOpen} disabled={closeDisabled}/>\r\n    </div>;\r\n\r\n    return (\r\n        <div>\r\n            <InvoiceInfoContent invoice={invoice} buttons={buttons}/>\r\n            <DialogWindow\r\n                dialogTitle=\"Verification\"\r\n                handleClose={closeAllInnerDialogs}\r\n                openDialog={openVerifyDialog}\r\n                form={form}/>\r\n            <DialogWindow\r\n                dialogTitle=\"Rejection\"\r\n                handleClose={closeAllInnerDialogs}\r\n                openDialog={openRejectDialog}\r\n                form={form}/>\r\n            <DialogWindow\r\n                dialogTitle=\"Closing\"\r\n                handleClose={closeAllInnerDialogs}\r\n                openDialog={openCloseDialog}\r\n                form={form}/>\r\n            <DialogWindow\r\n                dialogTitle=\"Editing\"\r\n                handleClose={closeAllInnerDialogs}\r\n                openDialog={openEditDialog}\r\n                form={form}/>\r\n        </div>\r\n    );\r\n})"]},"metadata":{},"sourceType":"module"}